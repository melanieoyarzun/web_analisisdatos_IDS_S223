<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Web materiales Analisis de Datos - Caso aplicación: Cursos de Verano</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Web materiales Analisis de Datos</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sesion0.html"> 
<span class="menu-text">Overview curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./talleres.html"> 
<span class="menu-text">talleres</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sesiones" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sesiones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sesiones">    
        <li>
    <a class="dropdown-item" href="./sesion1.html">
 <span class="dropdown-text">Sesión 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sesion2.html">
 <span class="dropdown-text">Sesión 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sesion3.html">
 <span class="dropdown-text">Sesión 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#caso-aplicación-cursos-de-verano-y-resultados-académicos" id="toc-caso-aplicación-cursos-de-verano-y-resultados-académicos" class="nav-link active" data-scroll-target="#caso-aplicación-cursos-de-verano-y-resultados-académicos">Caso aplicación: Cursos de verano y resultados académicos</a>
  <ul class="collapse">
  <li><a href="#taller-1-pregunta-4---aplicación-datos-de-educación" id="toc-taller-1-pregunta-4---aplicación-datos-de-educación" class="nav-link" data-scroll-target="#taller-1-pregunta-4---aplicación-datos-de-educación">Taller 1: Pregunta 4 - Aplicación datos de educación</a>
  <ul class="collapse">
  <li><a href="#pregunta-de-investigación" id="toc-pregunta-de-investigación" class="nav-link" data-scroll-target="#pregunta-de-investigación">Pregunta de investigación</a></li>
  <li><a href="#contexto" id="toc-contexto" class="nav-link" data-scroll-target="#contexto">Contexto</a></li>
  <li><a href="#datos-ficticios-dispobibles" id="toc-datos-ficticios-dispobibles" class="nav-link" data-scroll-target="#datos-ficticios-dispobibles">Datos ficticios dispobibles</a></li>
  </ul></li>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link" data-scroll-target="#objetivos">Objetivos:</a></li>
  <li><a href="#estadística-descriptiva" id="toc-estadística-descriptiva" class="nav-link" data-scroll-target="#estadística-descriptiva">3. Estadística descriptiva</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Caso aplicación: Cursos de Verano</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<section id="caso-aplicación-cursos-de-verano-y-resultados-académicos" class="level1">
<h1>Caso aplicación: Cursos de verano y resultados académicos</h1>
<section id="taller-1-pregunta-4---aplicación-datos-de-educación" class="level2">
<h2 class="anchored" data-anchor-id="taller-1-pregunta-4---aplicación-datos-de-educación">Taller 1: Pregunta 4 - Aplicación datos de educación</h2>
<p>Vamos a usar una situación ficticia, con datos simulados para poder aplicar de manera consisa los diferentes tipos de estrategias de identificación revisadas en clase. Algunas (que se supone ya manejan) las revisaremos muy rápidamente y en otras, vamos a tener mayor énfasis.</p>
<section id="pregunta-de-investigación" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-de-investigación">Pregunta de investigación</h3>
<p>Nuestro objetivo es responder la siguiente pregunta <strong>ficticia</strong> de investigación:</p>
<blockquote class="blockquote">
<p>Asistir a cursos de verano mejora los resultados académicos?</p>
</blockquote>
<p>Para responder esta pregunta, usaremos unos datos <strong>ficticios y simulados</strong></p>
</section>
<section id="contexto" class="level3">
<h3 class="anchored" data-anchor-id="contexto">Contexto</h3>
<p>La pregunta de investigación se inspira en trabajos como el de <a href="https://www.sciencedirect.com/science/article/pii/S0304407607001194?casa_token=hnnF764CKPoAAAAA:5b9WhCManNDsdW4SmOHnnzNr0fZIarW8s6EsvpQW7MdUt470eNPmN2T8IFCsNc6Iajew5tEeNA">Matsudaira (2007)</a> e intervenciones en estudiantes de bajo nivel socioeconómico por <a href="https://journals.sagepub.com/doi/abs/10.3102/0034654316687036">Dietrichson et al ( 2017)</a>.</p>
<p>El <strong>escenario ficticio</strong> es el siguiente:</p>
<ul>
<li>Para un conjunto de colegios en una comuna, existe la opción de asistir a un curso de verano intensivo durante el verano entre 5 y 6to básico.</li>
<li>El curso de verano se enfoca en mejorar las habilidades académicas de preparar la prueba de admisión a la universidad vigente (PSU en ese momento)</li>
<li>El curso de verano es gratuito, pero para ser matriculados requiere que los padres se involucren en un proceso.</li>
<li>Estamos interesados en testear el impacto de la participación en el curso en los resultados académicos de los estudiantes.</li>
</ul>
</section>
<section id="datos-ficticios-dispobibles" class="level3">
<h3 class="anchored" data-anchor-id="datos-ficticios-dispobibles">Datos ficticios dispobibles</h3>
<p>Los datos estan disponibles en <a href="https://github.com/melanieoyarzun/web_analisisdatos_IDS_S223/tree/main/data">https://github.com/melanieoyarzun/web_analisisdatos_IDS_S223/tree/main/data</a></p>
<ol type="1">
<li>school_data_1.csv</li>
</ol>
<ul>
<li>Usamos esta data para ejemplificar como cargar data guardada en formato csv.</li>
<li>Este dataset tiene información sobre cada individuo (con identificador id), la escuela a la que asiste, un indicador si participó en el curso de verano, sexo, ingreso del hogar (en logaritmo), educación de los padres, resultados en una prueba estandarizada que se realiza a nivel de la comuna tanto para el año 5 como para el año 6.</li>
</ul>
<ol start="2" type="1">
<li>school_data_2.dta</li>
</ol>
<ul>
<li>Usamos esta data para ejemplificar como cargar data guardada en formato STATA.</li>
<li>Este dataset tiene información de cada individuo (con identificador id).</li>
<li>Este dataset tiene la información si el individuo recibió la carta de invitación para participar del curso de verano.</li>
</ul>
<ol start="3" type="1">
<li>school_data_3.xlsx</li>
</ol>
<ul>
<li>Usamos este dataset para practicar como cargar datos guardados en formato Microsoft Excel.</li>
<li>Este dataset incluye datos sobre cada individuo (con identificador id)</li>
<li>Este dataset tiene información de rendimiento académico antes y después del curso de verano.</li>
</ul>
</section>
</section>
<section id="objetivos" class="level2">
<h2 class="anchored" data-anchor-id="objetivos">Objetivos:</h2>
<p>La idea de este taller es poner en práctica los primeros pasos para un análisis:</p>
<p>I. Este proceso generalmente incluye cargarlos, inspeccionarlos, limpiar y dar la estructura deseada.</p>
<ol start="2" type="I">
<li>También exploraremos los datos, usaremos estadísticas descriptivas que nos den una idea y resolver problemas potenciales (missing, ouliers, etc) antes de estimar cualquier modelo.</li>
</ol>
<p>En la vida real, este proceso suele ser bastante largo, laborioso e implica volver sobre lso pasos anteriores múltiples veces. También invlocura tomar desiciones por parte de los investigadores, por lo cual la documentación de esta fase es especialmente importante.</p>
<p>En nuestro caso, será bastante lineal y directo, ya que son datos ficticios simulados. Pero en la realidad, no suele ser así.</p>
<p>Pasos que debe realizar:</p>
<ol type="1">
<li>Preparación de los datos</li>
</ol>
<p>1.1. Cargue las tres bases de datos</p>
<p>1.2. Unir los datasets</p>
<p>Tenemos 3 bases de datos con información diferente de los mismos individuos. Generalmente es buena idea tener una sola gran tabla con toda esta información, especialmente si estimaremos modelos en base a ésta.</p>
<p>La base de datos 1 y 2 tienen una forma similar: los individuos son filas y las variables columnas y hay una sola fila para cada individuo. Empiece uniendo ambos.</p>
<ul>
<li>Notemos que el dataset unido debería tener 3491 filas y 9 columnas. Unimos todas las filas y agregamos al dataset de información del estudiante si recibió o no la carta (school_data_2)</li>
</ul>
<p>Entonces, siga el siguiente flujo de trabajo:</p>
<ol type="1">
<li><p>Unimos <em>school_data_1</em> y <em>school_data_2</em> usando como variable de unión <em>person_id</em> y guardamos el dataset unido como <em>school_data</em>.</p></li>
<li><p>Unimos <em>school_data_3</em> con <em>school_data</em> y sobre-escribimos <em>school_data</em>.</p>
<p>Notar que acá unimos por las columnas <em>person_id</em> y <em>school_id</em>. Esto no es realmente necesario porque cada estudiante con id única tiene un solo colegio, pero sirve de ejemplo en como usar más de una columna mediante.</p></li>
<li><p>Usamos la función <code>summary()</code> para obtener una estadística descriptiva de las variables en el dataset unido.</p></li>
<li><p>Preparar los datos</p></li>
</ol>
<p>2.1 Tidyng los datos</p>
<p>Ahora que hemos unido las bases de datos, trataremos de que satisfazgan los principios de <a href="https://vita.had.co.nz/papers/tidy-data.pdf">Tidy Data</a>.</p>
<p>Un data frame se considera “tidy” (Según Hadley) si se cumplen las siguientes condiciones:</p>
<ul>
<li>Cada columna (variable) contiene todas las medidas de la misma data/feature/caracteristica de las observaciones.</li>
<li>Cada fila contiene medidas de la misma unidad de observación.</li>
</ul>
<p>(puedes profundizar y ver más ejemplos aplicados en <a href="https://sscc.wisc.edu/sscc/pubs/DWE/book/6-2-tidy-data.html" class="uri">https://sscc.wisc.edu/sscc/pubs/DWE/book/6-2-tidy-data.html</a> )</p>
<p>Uno de estos, es que cada columna debe ser una variable y cafa fila una unidad de observación.</p>
<p>Si inspeccionamos el número de columnas: Son 17, pero tenemos 9 variables.</p>
<p>Es porque tenemos puntajes de las pruebas del año 2 al 10. Este tipo de datos son de <em>panel</em></p>
<p><img src="images/paste-4C87CB1E.png" class="img-fluid"></p>
<p>Generalmente, que hacemos con este tipo de datos depende del tipo de modelos que queramos usar. Si bien el formato wide es facil de entender, generlamente para modelos y análisi preferimos que esté en formato long. Especialmente cuando modelamos incluyendo efectos fijos También es este el que adhiere a los principios tidy de mejor manera.</p>
<p>Para cambiar a long, usamos <code>melt()</code></p>
<p>Ahora tenemos nuestros datos listos para que los inspeccionemos.</p>
<p>2.2 Selección de muestra</p>
<p>Ya que contamos con datos que siguen los principios de tidy data, lo siguiente es seleccionar la muestra apropiada.</p>
<p>En este trabajo, los unicos problemas que podríamos enfrentar son relacionados con valores faltantes o missing.</p>
<p>Identifique cuantas filas y comunas son, los tipos de varables y número de missing values.</p>
<p>En estos casos, para <em>parental_schooling</em> tenemos 45 missing y para <em>test_score</em> 11.</p>
<p>Asumamos que estos valores missing son random y deseamos remover estas filas.</p>
<p>2.2 Modificar los datos</p>
<p>Un último paso que haremos antes de hacer estadística decsriptiva es modificar los datos.</p>
<ol type="1">
<li><p>Cambio de nombre columna Cambiaremos los nombres de algunas columnas para que se vean bien en la tablas. Vambos renombrar la variable summpercap a summer_school.</p></li>
<li><p>Estandarizar puntajes En un siguiente paso, vamos a transformar los puntajes en la pruebas a una variable que tenga media 0 y desviación estándar 1. Es mejor trabajar con variables estandarizadas, ya que no requieren conocer el conexto específico de la medida y es más facil de comunicar y comparar.</p></li>
</ol>
<p>Ya estamos bien, ahora pasamos a conocer mejor nuestros datos con estadística descriptiva.</p>
</section>
<section id="estadística-descriptiva" class="level2">
<h2 class="anchored" data-anchor-id="estadística-descriptiva">3. Estadística descriptiva</h2>
<p>Hasta ahora, cargamos datos en diversos formatos (csv, dta y xlsx) los unimos, re-estructuramos el dataset, removimos valores missing y generamos algunas transformaciones. El siguiente paso es empezar a conocer nuestros datos. Para esto haremos tablas de estadísticas descriptivas y también algunos graficos descriptivos.</p>
<p>3.1 Tablas de etsádistocas descriptivas Incluya la media, la desviación estandar, la mediana, max y min, al menos.</p>
<p>3.2 Gráficos de estadística descriptiva Realice al menos scatter plot, histograma, box plot y correalograma.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>